{% extends "base.html" %}
{% block content %}
{% if request.query_params.get("seeded") %}

<section class="notice">
  Demo data seeded. View events below or in the Events tab.
</section>
{% endif %}
{% if request.query_params.get("synced") %}
<section class="notice">
  Catalog sync completed. New objects are now available for screening.
</section>
{% endif %}
<section class="hero">
  <div>
    <h1>Safety Overview</h1>
    <p>See upcoming close approaches, understand why they matter, and decide what to do next.</p>
  </div>
  <div class="hero-card">
    <div class="metric">
      <div class="metric-label">Satellites</div>
      <div class="metric-value">{{ satellite_count }}</div>
    </div>
    <div class="metric">
      <div class="metric-label">Events</div>
      <div class="metric-value">{{ event_count }}</div>
    </div>
    <div class="metric">
      <div class="metric-label">High Risk</div>
      <div class="metric-value">{{ high_risk }}</div>
    </div>
  </div>

<div class="hero-actions">
  <a class="primary" href="/events-ui">Review Alerts</a>
  <a class="secondary" href="/ingest-ui">Add Data</a>
  <a class="secondary" href="/satellites-ui">Add Satellite</a>
</div>

</section>

<section class="panel">
  <div class="panel-header">
    <h2>Start Here</h2>
    <span class="panel-sub">A simple path for first-time users</span>
  </div>
  <div class="grid">
    <div class="card">
      <h3>1. Add a Satellite</h3>
      <p class="panel-sub">Create your fleet entry (name + optional NORAD catalog ID).</p>
      <a class="secondary" href="/satellites-ui">Open Satellites</a>
    </div>
    <div class="card">
      <h3>2. Add Tracking Data</h3>
      <p class="panel-sub">Ingest orbit states or attach a CCSDS CDM (KVN) message.</p>
      <a class="secondary" href="/ingest-ui">Open Add Data</a>
    </div>
    <div class="card">
      <h3>3. Review Alerts</h3>
      <p class="panel-sub">See risk tier, confidence, and export a PDF report.</p>
      <a class="secondary" href="/events-ui">Open Alerts</a>
    </div>
  </div>
  <div class="panel-subsection">
    <form method="post" action="/demo/seed">
      <button class="secondary" type="submit">Seed Demo Data</button>
    </form>
  </div>
</section>

<section class="panel">
  <div class="panel-header">
    <h2>Catalog Sync</h2>
    <span class="panel-sub">Public catalog (CelesTrak / Space-Track if configured)</span>
  </div>
  <div class="catalog-grid">
    <div>
      <div class="metric-label">Catalog Objects</div>
      <div class="metric-value">{{ catalog_count }}</div>
    </div>
    <div>
      <div class="metric-label">Last Sync</div>
      <div class="metric-value">{{ last_sync or 'Never' }}</div>
    </div>
    <form method="post" action="/catalog/sync-ui">
      <button class="primary" type="submit">Sync Now</button>
    </form>
  </div>
  <div class="notice">
    Public orbit data is best-effort and is for awareness only. For operational decisions, use operator-grade ephemerides.
  </div>
</section>

<section class="panel">
  <div class="panel-header">
    <h2>Recent Conjunction Events</h2>
    <span class="panel-sub">Last 7 days</span>
  </div>
  <div class="table">
    <div class="table-row header">
      <span>Event ID</span>
      <span>Satellite</span>
      <span>Object</span>
      <span>TCA</span>
      <span>Miss Distance (km)</span>
    </div>
    {% for event in recent_events %}
    <a class="table-row" href="/events-ui/{{ event.id }}">
      <span>#{{ event.id }}</span>
      <span>{{ event.satellite_id }}</span>
      <span>{{ event.object_id }}</span>
      <span>{{ event.tca }}</span>
      <span>{{ "%.3f"|format(event.miss_distance) }}</span>
    </a>
    {% else %}
    <div class="table-row empty">No events yet. Ingest orbit states to begin.</div>
    {% endfor %}
  </div>
</section>
{% endblock %}
